<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asisten Teks Arab</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // Komponen Ikon untuk UI yang lebih baik
        const BookOpen = (props) => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
          </svg>
        );

        const Languages = (props) => (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <path d="m5 8 6 6" />
            <path d="m4 14 6-6 2-3" />
            <path d="M2 5h12" />
            <path d="M7 2h1" />
            <path d="m22 22-5-10-5 10" />
            <path d="M14 18h6" />
          </svg>
        );
        
        const KeyRound = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z" /><circle cx="16.5" cy="7.5" r=".5" fill="currentColor" />
            </svg>
        );

        // Komponen utama aplikasi
        function App() {
          // State untuk menyimpan input, pilihan, hasil, dan status loading/error
          const [inputText, setInputText] = React.useState('');
          const [language, setLanguage] = React.useState('id');
          const [textType, setTextType] = React.useState('general');
          // Kunci API sekarang sudah diisi secara default
          const [apiKey, setApiKey] = React.useState('AIzaSyBU9KgI49GJx93HNIc8cqZrGnr2WUimLhM');
          const [result, setResult] = React.useState(null);
          const [isLoading, setIsLoading] = React.useState(false);
          const [error, setError] = React.useState(null);

          // Daftar bahasa untuk dropdown
          const languages = [
            { code: 'id', name: 'Indonesia' },
            { code: 'en', name: 'English' },
            { code: 'ms', name: 'Melayu' },
            { code: 'tr', name: 'Türkçe' },
            { code: 'ur', name: 'اردو' },
          ];

          // Fungsi untuk memanggil API Gemini
          const handleSubmit = async (e) => {
            e.preventDefault();
            if (!apiKey.trim()) {
              setError('Harap masukkan Kunci API Google AI Anda untuk melanjutkan.');
              return;
            }
            if (!inputText.trim()) {
              setError('Teks Arab tidak boleh kosong.');
              return;
            }

            setIsLoading(true);
            setError(null);
            setResult(null);

            const prompt = `
              Anda adalah seorang ahli dalam bahasa Arab dan studi Islam. Tugas Anda adalah memproses teks Arab berikut:

              Teks: "${inputText}"

              Lakukan tugas-tugas berikut dengan seksama:
              1.  **Harokat**: Berikan harokat (vokal diakritik) yang lengkap dan akurat pada teks Arab tersebut sesuai dengan kaidah nahwu dan sharaf yang benar.
              2.  **Terjemahan**: Terjemahkan teks yang sudah diberi harokat ke dalam bahasa "${languages.find(l => l.code === language)?.name}". Pastikan terjemahan akurat dan menjaga makna asli.
              3.  **Penjelasan**: Berikan penjelasan mendalam tentang teks tersebut. Jika ini adalah bagian dari tafsir Al-Quran atau syarah hadits (berdasarkan konteks tipe teks: ${textType}), jelaskan konteksnya, makna istilah-istilah penting, dan pelajaran yang bisa diambil. Jika teks umum, jelaskan maknanya secara umum.
              4.  **Referensi**: Jika teks ini adalah kutipan dari Al-Quran atau Hadits, identifikasi dan sebutkan sumbernya seakurat mungkin (contoh: "QS. Al-Baqarah: 255" atau "HR. Bukhari no. 1"). Jika tidak dapat diidentifikasi atau teks umum, tulis "Tidak teridentifikasi".

              Pastikan output Anda dalam format JSON yang ketat.
            `;
            
            const schema = {
                type: "OBJECT",
                properties: {
                    harokat: { type: "STRING" },
                    translation: { type: "STRING" },
                    explanation: { type: "STRING" },
                    reference: { type: "STRING" },
                },
                required: ["harokat", "translation", "explanation", "reference"]
            };

            try {
                const payload = { 
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: schema,
                    }
                };
                
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(`Permintaan API gagal: ${errorBody.error.message}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content?.parts?.[0]?.text) {
                    const responseText = data.candidates[0].content.parts[0].text;
                    const parsedJson = JSON.parse(responseText);
                    setResult(parsedJson);
                } else {
                     if (data.candidates?.[0]?.finishReason === 'SAFETY') {
                        throw new Error("Konten diblokir karena kebijakan keamanan. Harap ubah teks input Anda.");
                    }
                    throw new Error("Respons dari API tidak valid atau kosong.");
                }

            } catch (err) {
              console.error(err);
              setError(err.message || 'Terjadi kesalahan yang tidak diketahui.');
            } finally {
              setIsLoading(false);
            }
          };

          // Komponen untuk menampilkan hasil
          const ResultCard = ({ title, children, isArabic = false }) => (
            <div className="bg-gray-50 p-4 rounded-lg shadow-inner border border-gray-200">
              <h3 className="text-md font-semibold text-cyan-800 mb-2 border-b border-gray-200 pb-2">{title}</h3>
              <div className={`text-gray-700 whitespace-pre-wrap ${isArabic ? 'text-right text-2xl font-serif leading-loose' : 'text-left'}`} dir={isArabic ? 'rtl' : 'ltr'}>
                {children}
              </div>
            </div>
          );

          return (
            <div className="bg-gray-100 text-gray-800 min-h-screen font-sans p-4 sm:p-6 md:p-8">
              <div className="max-w-4xl mx-auto">
                <header className="text-center mb-8">
                  <h1 className="text-4xl sm:text-5xl font-bold text-cyan-700">Asisten Teks Arab</h1>
                  <p className="text-gray-600 mt-2">Beri harokat, terjemahkan, dan dapatkan penjelasan untuk teks Arab Anda.</p>
                </header>

                <main>
                  <form onSubmit={handleSubmit} className="bg-white p-6 rounded-xl shadow-lg space-y-6 border border-gray-200">
                    <div>
                        <label htmlFor="api-key" className="flex items-center text-lg font-medium text-gray-700 mb-2">
                            <KeyRound className="w-5 h-5 mr-2" />
                            Kunci API Google AI
                        </label>
                        <input
                            type="password"
                            id="api-key"
                            value={apiKey}
                            onChange={(e) => setApiKey(e.target.value)}
                            placeholder="Kunci API sudah dimasukkan"
                            className="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                        />
                         <p className="text-xs text-gray-500 mt-2">
                            Kunci API Anda sudah terisi. Anda bisa menggantinya jika perlu.
                        </p>
                    </div>

                    <hr/>

                    <div>
                      <label htmlFor="arabic-text" className="block text-lg font-medium text-gray-700 mb-2">
                        Masukkan Teks Arab
                      </label>
                      <textarea
                        id="arabic-text"
                        value={inputText}
                        onChange={(e) => setInputText(e.target.value)}
                        placeholder="...الصلاة والسلام على نبينا محمد"
                        className="w-full h-40 p-4 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 text-right text-xl font-serif text-gray-800"
                        dir="rtl"
                      />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label htmlFor="language" className="flex items-center text-lg font-medium text-gray-700 mb-2">
                          <Languages className="w-5 h-5 mr-2" />
                          Terjemahkan ke Bahasa
                        </label>
                        <select
                          id="language"
                          value={language}
                          onChange={(e) => setLanguage(e.target.value)}
                          className="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                        >
                          {languages.map((lang) => (
                            <option key={lang.code} value={lang.code}>{lang.name}</option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label htmlFor="text-type" className="flex items-center text-lg font-medium text-gray-700 mb-2">
                            <BookOpen className="w-5 h-5 mr-2" />
                            Jenis Teks
                        </label>
                        <select
                          id="text-type"
                          value={textType}
                          onChange={(e) => setTextType(e.target.value)}
                          className="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                        >
                          <option value="general">Umum</option>
                          <option value="tafsir">Tafsir Al-Quran</option>
                          <option value="hadith">Syarah Hadits</option>
                        </select>
                      </div>
                    </div>

                    <button
                      type="submit"
                      disabled={isLoading}
                      className="w-full flex justify-center items-center p-4 bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-400 rounded-lg text-lg font-bold text-white transition-colors duration-200"
                    >
                      {isLoading ? (
                        <>
                          <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                          Memproses...
                        </>
                      ) : (
                        'Proses Teks'
                      )}
                    </button>
                  </form>

                  {error && (
                    <div className="mt-6 p-4 bg-red-100 border border-red-300 text-red-800 rounded-lg text-center">
                      {error}
                    </div>
                  )}

                  {result && (
                    <div className="mt-8 bg-white p-6 rounded-xl shadow-lg space-y-6 border border-gray-200">
                      <ResultCard title="Teks dengan Harokat" isArabic={true}>
                        {result.harokat}
                      </ResultCard>
                      <ResultCard title={`Terjemahan (${languages.find(l => l.code === language)?.name})`}>
                        {result.translation}
                      </ResultCard>
                      <ResultCard title="Penjelasan">
                        {result.explanation}
                      </ResultCard>
                      <ResultCard title="Referensi Sumber">
                        {result.reference}
                      </ResultCard>
                    </div>
                  )}
                </main>

                <footer className="text-center mt-12 text-gray-500 text-sm">
                  <p>Dibuat dengan Gemini AI</p>
                </footer>
              </div>
            </div>
          );
        }

        // Render the React component into the 'root' div
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
